
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="..">
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.14">
    
    
      
        <title>azint_writer - azint-writer</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.342714a4.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#azint_writer.azint_writer" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="azint-writer" class="md-header__button md-logo" aria-label="azint-writer" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            azint-writer
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              azint_writer
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="azint-writer" class="md-nav__button md-logo" aria-label="azint-writer" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    azint-writer
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Code Reference
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Code Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    azint_writer
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    azint_writer
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#azint_writer.azint_writer" class="md-nav__link">
    <span class="md-ellipsis">
      azint_writer
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#azint_writer.azint_writer.NXWriter" class="md-nav__link">
    <span class="md-ellipsis">
      NXWriter
    </span>
  </a>
  
    <nav class="md-nav" aria-label="NXWriter">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#azint_writer.azint_writer.NXWriter.add_data" class="md-nav__link">
    <span class="md-ellipsis">
      add_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#azint_writer.azint_writer.NXWriter.write_header" class="md-nav__link">
    <span class="md-ellipsis">
      write_header
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#azint_writer.azint_writer" class="md-nav__link">
    <span class="md-ellipsis">
      azint_writer
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#azint_writer.azint_writer.NXWriter" class="md-nav__link">
    <span class="md-ellipsis">
      NXWriter
    </span>
  </a>
  
    <nav class="md-nav" aria-label="NXWriter">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#azint_writer.azint_writer.NXWriter.add_data" class="md-nav__link">
    <span class="md-ellipsis">
      add_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#azint_writer.azint_writer.NXWriter.write_header" class="md-nav__link">
    <span class="md-ellipsis">
      write_header
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



  <h1>azint_writer</h1>

<div class="doc doc-object doc-module">



<a id="azint_writer.azint_writer"></a>
    <div class="doc doc-contents first">









  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="azint_writer.azint_writer.NXWriter" class="doc doc-heading">
            <code>NXWriter</code>


</h2>


    <div class="doc doc-contents ">


        <p>NXWriter class for writing azimuthal integration data to NeXus HDF5 files.
This class handles the creation of the NeXus hierarchy, including metadata
such as instrument configuration, source details, monochromator properties,
and integration parameters. It supports both 1D and 2D data formats, allowing
for flexible data storage and retrieval.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="azint_writer.azint_writer.NXWriter.-">-</span></code></td>
            <td>
                  <code><span title="azint_writer.azint_writer.NXWriter.ai">ai</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Azimuthal integrator object (should contain integration results and parameters)</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="azint_writer.azint_writer.NXWriter.-">-</span></code></td>
            <td>
                  <code>output_file (str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to output HDF5 file</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="azint_writer.azint_writer.NXWriter.-">-</span></code></td>
            <td>
                  <code>write_1d (bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to include 1D data in the file</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="azint_writer.azint_writer.NXWriter.-">-</span></code></td>
            <td>
                  <code>write_2d (bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to include 2D data in the file</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="azint_writer.azint_writer.NXWriter.-">-</span></code></td>
            <td>
                  <code>instrument_name (str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of the instrument</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="azint_writer.azint_writer.NXWriter.-">-</span></code></td>
            <td>
                  <code>source_name (str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of the source</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="azint_writer.azint_writer.NXWriter.-">-</span></code></td>
            <td>
                  <code>source_type (str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Type of the source (e.g., 'Synchrotron')</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="azint_writer.azint_writer.NXWriter.-">-</span></code></td>
            <td>
                  <code>source_probe (str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Type of probe (e.g., 'x-ray')</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Methods:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
            <tr class="doc-section-item">
              <td><code><span title="azint_writer.azint_writer.NXWriter.- write_header">- write_header</span></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Creates and writes the NeXus hierarchy for the dataset,
including metadata such as instrument configuration, source details,
monochromator properties, and integration parameters.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><span title="azint_writer.azint_writer.NXWriter.- add_data">- add_data</span></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Adds azimuthal integration data to the HDF5 file under the
proper NXdata group.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><span title="azint_writer.azint_writer.NXWriter.- write_radial_axis">- write_radial_axis</span></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Writes radial axis information to the specified group.</p>
                </div>
              </td>
            </tr>
      </tbody>
    </table>







              <details class="quote">
                <summary>Source code in <code>azint_writer/azint_writer.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">NXWriter</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    NXWriter class for writing azimuthal integration data to NeXus HDF5 files.</span>
<span class="sd">    This class handles the creation of the NeXus hierarchy, including metadata</span>
<span class="sd">    such as instrument configuration, source details, monochromator properties,</span>
<span class="sd">    and integration parameters. It supports both 1D and 2D data formats, allowing</span>
<span class="sd">    for flexible data storage and retrieval.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        - ai: Azimuthal integrator object (should contain integration results and parameters)</span>
<span class="sd">        - output_file (str): Path to output HDF5 file</span>
<span class="sd">        - write_1d (bool): Whether to include 1D data in the file</span>
<span class="sd">        - write_2d (bool): Whether to include 2D data in the file</span>
<span class="sd">        - instrument_name (str): Name of the instrument</span>
<span class="sd">        - source_name (str): Name of the source</span>
<span class="sd">        - source_type (str): Type of the source (e.g., &#39;Synchrotron&#39;)</span>
<span class="sd">        - source_probe (str): Type of probe (e.g., &#39;x-ray&#39;)</span>

<span class="sd">    Methods:</span>
<span class="sd">        - write_header: Creates and writes the NeXus hierarchy for the dataset,</span>
<span class="sd">          including metadata such as instrument configuration, source details,</span>
<span class="sd">          monochromator properties, and integration parameters.</span>
<span class="sd">        - add_data: Adds azimuthal integration data to the HDF5 file under the</span>
<span class="sd">          proper NXdata group.</span>
<span class="sd">        - write_radial_axis: Writes radial axis information to the specified group.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> 
        <span class="n">ai</span><span class="p">,</span> 
        <span class="n">output_file</span><span class="p">,</span>
        <span class="n">write_1d</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
        <span class="n">write_2d</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
        <span class="n">instrument_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
        <span class="n">source_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
        <span class="n">source_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
        <span class="n">source_probe</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ai</span> <span class="o">=</span> <span class="n">ai</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output_file</span> <span class="o">=</span> <span class="n">output_file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_1d</span> <span class="o">=</span> <span class="n">write_1d</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_2d</span> <span class="o">=</span> <span class="n">write_2d</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">instrument_name</span> <span class="o">=</span> <span class="n">instrument_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">source_name</span> <span class="o">=</span> <span class="n">source_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">source_type</span> <span class="o">=</span> <span class="n">source_type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">source_probe</span> <span class="o">=</span> <span class="n">source_probe</span>

        <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output_file</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fh_w</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fh</span> <span class="o">=</span> <span class="n">fh_w</span>
            <span class="k">if</span> <span class="s2">&quot;entry&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">fh_w</span><span class="p">:</span> <span class="c1"># this condition can be omitted, check that</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">write_header</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">write_header</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates and writes the NeXus hierarchy for the dataset,</span>
<span class="sd">        including metadata such as instrument configuration, </span>
<span class="sd">        source details, monochromator properties, and integration parameters.</span>

<span class="sd">        This method will automatically determine what type(s) of data </span>
<span class="sd">        (1D/2D) are to be written and populate corresponding subentries.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;writing header started, azint version is </span><span class="si">{</span><span class="n">azint</span><span class="o">.</span><span class="n">__version__</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">entry</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fh</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="s2">&quot;entry&quot;</span><span class="p">,</span> <span class="n">track_order</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">entry</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;NX_class&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;NXentry&quot;</span>
        <span class="n">entry</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;data&quot;</span> 
        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;entry is created in the file&quot;</span><span class="p">)</span>


        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">write_1d</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">write_2d</span><span class="p">):</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Creating </span><span class="si">{</span><span class="s1">&#39;NXazint1d&#39;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">write_1d</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;NXazint2d&#39;</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">definition</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;definition&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s1">&#39;NXazint1d&#39;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">write_1d</span> <span class="k">else</span> <span class="s1">&#39;NXazint2d&#39;</span><span class="p">)</span>       

        <span class="n">solid_angle</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;solid_angle_applied&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="kc">True</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">solid_angle</span> <span class="k">else</span> <span class="kc">False</span><span class="p">)</span>

        <span class="n">polarization</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">polarization_factor</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">polarization_factor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="mi">0</span>
        <span class="n">polarization_applied</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;polarization_applied&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="kc">True</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">polarization_factor</span>  <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">False</span><span class="p">)</span>

        <span class="n">normalization</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;normalization_applied&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="kc">True</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">normalized</span> <span class="k">else</span> <span class="kc">False</span><span class="p">)</span>

        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;solid_angle_applied and polarization_applied data sets are created&quot;</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;solid_angle: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">solid_angle</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;polarization_factor: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">polarization_factor</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>


        <span class="c1"># Add instrument</span>
        <span class="n">instrument</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="s2">&quot;instrument&quot;</span><span class="p">,</span> <span class="n">track_order</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">instrument</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;NX_class&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;NXinstrument&quot;</span>
        <span class="n">instrument</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;name&quot;</span> 
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Instrument: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">instrument_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">instrument</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">string_</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">instrument_name</span><span class="p">)</span>

        <span class="c1"># Add monochromator</span>
        <span class="n">mono</span> <span class="o">=</span> <span class="n">instrument</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="s2">&quot;monochromator&quot;</span><span class="p">,</span> <span class="n">track_order</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">mono</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;NX_class&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;NXmonochromator&quot;</span>
        <span class="n">mono</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;energy&quot;</span>  

        <span class="c1"># Add source</span>
        <span class="n">source</span> <span class="o">=</span> <span class="n">instrument</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="s2">&quot;source&quot;</span><span class="p">,</span> <span class="n">track_order</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">source</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;NX_class&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;NXsource&quot;</span>
        <span class="n">source</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;name&quot;</span> 
        <span class="n">source</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">source_name</span>
        <span class="n">source</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">source_type</span>
        <span class="n">source</span><span class="p">[</span><span class="s1">&#39;probe&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">source_type</span>

        <span class="n">poni_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">poni</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">poni</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">poni_file</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">pf</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Reading poni file ...&quot;</span><span class="p">)</span>
                    <span class="n">ponif</span> <span class="o">=</span> <span class="n">pf</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
                    <span class="n">wavelength_found</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">ponif</span><span class="o">.</span><span class="n">splitlines</span><span class="p">():</span>
                        <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Wavelength:&quot;</span><span class="p">):</span>
                            <span class="n">wlength_str</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                            <span class="k">try</span><span class="p">:</span>
                                <span class="n">wlength</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">wlength_str</span><span class="p">)</span>
                                <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;From poni file: wavelength: </span><span class="si">{</span><span class="n">wlength</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">1e10</span><span class="si">}</span><span class="s2"> Å&quot;</span><span class="p">)</span>
                                <span class="n">wavelength_found</span> <span class="o">=</span> <span class="kc">True</span>
                            <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                                <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error converting wavelength to float: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                                <span class="n">wlength</span> <span class="o">=</span> <span class="kc">None</span>
                            <span class="k">break</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">wavelength_found</span><span class="p">:</span>
                        <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Wavelength not found in poni file.&quot;</span><span class="p">)</span>
                        <span class="n">wlength</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Cannot open poni file: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">poni</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="n">ponif</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">poni</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
            <span class="n">wavelength_found</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">wlength</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">poni</span><span class="p">[</span><span class="s1">&#39;wavelength&#39;</span><span class="p">])</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;From poni file: wavelength: </span><span class="si">{</span><span class="n">wlength</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">1e10</span><span class="si">}</span><span class="s2"> Å&quot;</span><span class="p">)</span>
                <span class="n">wavelength_found</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error converting wavelength to float: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">wlength</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">wavelength_found</span><span class="p">:</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Wavelength not found in poni dict.&quot;</span><span class="p">)</span>
                <span class="n">wlength</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Provided format for poni is wrong.&quot;</span><span class="p">)</span>

        <span class="c1"># Now handle data splitting</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">write_1d</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">write_2d</span><span class="p">):</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Creating 1D and 2D data ...&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">azimuth_axis</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;2d data is not available.&quot;</span><span class="p">)</span>
            <span class="c1"># 1D data subentry</span>
            <span class="n">azint1dSE</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="s2">&quot;azint1d&quot;</span><span class="p">,</span> <span class="n">track_order</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">azint1dSE</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;NX_class&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;NXsubentry&quot;</span>

            <span class="n">definition</span> <span class="o">=</span> <span class="n">azint1dSE</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;definition&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s2">&quot;NXazint1d&quot;</span><span class="p">)</span>

            <span class="n">azint1dSE</span><span class="p">[</span><span class="s2">&quot;instrument&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">h5py</span><span class="o">.</span><span class="n">SoftLink</span><span class="p">(</span><span class="s1">&#39;/entry/instrument&#39;</span><span class="p">)</span>

            <span class="n">reduction</span> <span class="o">=</span> <span class="n">azint1dSE</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="s2">&quot;reduction&quot;</span><span class="p">,</span> <span class="n">track_order</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">reduction</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;NX_class&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;NXprocess&quot;</span>
            <span class="n">prog</span> <span class="o">=</span> <span class="n">reduction</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;program&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s2">&quot;azint&quot;</span><span class="p">)</span>
            <span class="n">ver</span> <span class="o">=</span> <span class="n">reduction</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;version&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;azint </span><span class="si">{</span><span class="n">azint</span><span class="o">.</span><span class="n">__version__</span><span class="si">}</span><span class="se">\n</span><span class="s2">azint-writer </span><span class="si">{</span><span class="n">__version__</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">date</span> <span class="o">=</span> <span class="n">reduction</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;date&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%A, %B </span><span class="si">%d</span><span class="s2">, %Y at %I:%M %p&quot;</span><span class="p">))</span>
            <span class="n">ref</span> <span class="o">=</span> <span class="n">reduction</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;reference&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s2">&quot;Jensen, A. B., et al., (2022). J. Synchrotron Rad. 29, 1420-1428.</span><span class="se">\n</span><span class="s2">https://doi.org/10.1107/S1600577522008232,</span><span class="se">\n</span><span class="s2">https://maxiv-science.github.io/azint/&quot;</span><span class="p">)</span>
            <span class="n">note</span> <span class="o">=</span> <span class="n">reduction</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;note&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s2">&quot;Geometry convention:</span><span class="se">\n</span><span class="s2">Azimuthal origin in the horizontal plane to the right of the beam position, i.e., at 3 o’clock,</span><span class="se">\n</span><span class="s2">on the detector face. Positive azimuthal direction: clockwise.&quot;</span><span class="p">)</span>

            <span class="nb">input</span> <span class="o">=</span> <span class="n">reduction</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="s2">&quot;input&quot;</span><span class="p">,</span> <span class="n">track_order</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="nb">input</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;NX_class&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;NXparameters&quot;</span>
            <span class="n">dset</span> <span class="o">=</span> <span class="nb">input</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;poni&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">ponif</span><span class="p">,</span> <span class="n">track_order</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">dset</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;filename&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">poni_file</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">poni</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="s2">&quot;Poni dict.&quot;</span>

            <span class="n">wavelength</span> <span class="o">=</span> <span class="n">mono</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;wavelength&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">wlength</span> <span class="o">*</span> <span class="mf">1e10</span><span class="p">,</span> <span class="n">track_order</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">wavelength</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;units&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;angstrom&quot;</span>
            <span class="n">energy</span> <span class="o">=</span> <span class="n">mono</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;energy&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">(</span><span class="mf">1.2398</span> <span class="o">*</span> <span class="mf">1e-9</span><span class="p">)</span> <span class="o">/</span> <span class="n">wlength</span><span class="p">,</span> <span class="n">track_order</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">energy</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;units&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;keV&quot;</span>

            <span class="n">wavelength2</span> <span class="o">=</span> <span class="nb">input</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;wavelength&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">wlength</span> <span class="o">*</span> <span class="mf">1e10</span><span class="p">)</span>
            <span class="n">wavelength2</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;units&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;angstrom&quot;</span>

            <span class="nb">input</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;n_splitting&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">n_splitting</span><span class="p">)</span>
            <span class="nb">input</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;radial_bins&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">radial_bins</span><span class="p">)</span>
            <span class="nb">input</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;azimuth_bins&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="nb">input</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;unit&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">unit</span><span class="p">)</span>    
            <span class="nb">input</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;mask&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">mask_path</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">mask_path</span> <span class="k">else</span> <span class="p">(</span><span class="s2">&quot;A numpy array was provided&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">mask</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="s2">&quot;None&quot;</span><span class="p">))</span>

            <span class="nb">input</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;solid_angle&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="kc">True</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">solid_angle</span> <span class="k">else</span> <span class="kc">False</span><span class="p">)</span>

            <span class="n">polarization</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">polarization_factor</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">polarization_factor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="mi">0</span>
            <span class="nb">input</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;polarization_factor&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">polarization</span><span class="p">)</span>
            <span class="n">error_model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">error_model</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">error_model</span> <span class="k">else</span> <span class="s2">&quot;None&quot;</span>
            <span class="nb">input</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;error_model&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">error_model</span><span class="p">)</span>


            <span class="n">azint1d</span> <span class="o">=</span> <span class="n">azint1dSE</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">)</span>
            <span class="n">azint1d</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;NX_class&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;NXdata&quot;</span>
            <span class="n">azint1d</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;signal&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;I&quot;</span>
            <span class="n">azint1d</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;axes&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="s2">&quot;radial_axis&quot;</span><span class="p">]</span>
            <span class="n">azint1d</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;interpretation&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;spectrum&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write_radial_axis</span><span class="p">(</span><span class="n">azint1d</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">unit</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">radial_axis</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">radial_bins</span><span class="p">)</span>

            <span class="n">azint2dSE</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="s2">&quot;azint2d&quot;</span><span class="p">,</span> <span class="n">track_order</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">azint2dSE</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;NX_class&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;NXsubentry&quot;</span>

            <span class="n">definition</span> <span class="o">=</span> <span class="n">azint2dSE</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;definition&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s2">&quot;NXazint2d&quot;</span><span class="p">)</span>

            <span class="n">azint2dSE</span><span class="p">[</span><span class="s2">&quot;instrument&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">h5py</span><span class="o">.</span><span class="n">SoftLink</span><span class="p">(</span><span class="s1">&#39;/entry/instrument&#39;</span><span class="p">)</span>

            <span class="n">reduction</span> <span class="o">=</span> <span class="n">azint2dSE</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="s2">&quot;reduction&quot;</span><span class="p">,</span> <span class="n">track_order</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">reduction</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;NX_class&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;NXprocess&quot;</span>
            <span class="n">prog</span> <span class="o">=</span> <span class="n">reduction</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;program&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s2">&quot;azint-pipeline&quot;</span><span class="p">)</span>
            <span class="n">ver</span> <span class="o">=</span> <span class="n">reduction</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;version&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;azint </span><span class="si">{</span><span class="n">azint</span><span class="o">.</span><span class="n">__version__</span><span class="si">}</span><span class="se">\n</span><span class="s2">azint-writer </span><span class="si">{</span><span class="n">__version__</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">date</span> <span class="o">=</span> <span class="n">reduction</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;date&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%A, %B </span><span class="si">%d</span><span class="s2">, %Y at %I:%M %p&quot;</span><span class="p">))</span>
            <span class="n">ref</span> <span class="o">=</span> <span class="n">reduction</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;reference&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s2">&quot;Jensen, A. B., et al., (2022). J. Synchrotron Rad. 29, 1420-1428.</span><span class="se">\n</span><span class="s2">https://doi.org/10.1107/S1600577522008232,</span><span class="se">\n</span><span class="s2">https://maxiv-science.github.io/azint/&quot;</span><span class="p">)</span>
            <span class="n">note</span> <span class="o">=</span> <span class="n">reduction</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;note&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s2">&quot;Geometry convention:</span><span class="se">\n</span><span class="s2">Azimuthal origin in the horizontal plane to the right of the beam position, i.e., at 3 o’clock,</span><span class="se">\n</span><span class="s2">on the detector face. Positive azimuthal direction: clockwise.&quot;</span><span class="p">)</span>

            <span class="nb">input</span> <span class="o">=</span> <span class="n">reduction</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="s2">&quot;input&quot;</span><span class="p">,</span> <span class="n">track_order</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="nb">input</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;NX_class&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;NXparameters&quot;</span>

            <span class="n">wavelength2</span> <span class="o">=</span> <span class="nb">input</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;wavelength&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">wlength</span> <span class="o">*</span> <span class="mf">1e10</span><span class="p">)</span>
            <span class="n">wavelength2</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;units&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;angstrom&quot;</span>

            <span class="nb">input</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;n_splitting&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">n_splitting</span><span class="p">)</span>
            <span class="nb">input</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;radial_bins&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">radial_bins</span><span class="p">)</span>
            <span class="nb">input</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;azimuth_bins&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">azimuth_bins</span><span class="p">)</span>
            <span class="nb">input</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;unit&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">unit</span><span class="p">)</span>
            <span class="nb">input</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;mask&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">mask_path</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">mask_path</span> <span class="k">else</span> <span class="p">(</span><span class="s2">&quot;A numpy array was provided&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">mask</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="s2">&quot;None&quot;</span><span class="p">))</span>

            <span class="nb">input</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;solid_angle&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="kc">True</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">solid_angle</span> <span class="k">else</span> <span class="kc">False</span><span class="p">)</span>

            <span class="n">polarization</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">polarization_factor</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">polarization_factor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="mi">0</span>
            <span class="nb">input</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;polarization_factor&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">polarization</span><span class="p">)</span>
            <span class="n">error_model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">error_model</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">error_model</span> <span class="k">else</span> <span class="s2">&quot;None&quot;</span>
            <span class="nb">input</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;error_model&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">error_model</span><span class="p">)</span>

            <span class="n">azint2d</span> <span class="o">=</span> <span class="n">azint2dSE</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">)</span>
            <span class="n">azint2d</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;NX_class&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;NXdata&quot;</span>
            <span class="n">azint2d</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;signal&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;I&quot;</span>
            <span class="n">azint2d</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;axes&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="s2">&quot;azimuthal_axis&quot;</span><span class="p">,</span> <span class="s2">&quot;radial_axis&quot;</span><span class="p">]</span>
            <span class="n">azint2d</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;interpretation&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;image&quot;</span>
            <span class="n">entry</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">h5py</span><span class="o">.</span><span class="n">SoftLink</span><span class="p">(</span><span class="s1">&#39;/entry/azint1d/data&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write_radial_axis</span><span class="p">(</span><span class="n">azint2d</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">unit</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">radial_axis</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">radial_bins</span><span class="p">)</span>
            <span class="n">dset</span> <span class="o">=</span> <span class="n">azint2d</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;azimuthal_axis&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">azimuth_axis</span><span class="p">)</span>
            <span class="n">dset</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;units&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;degrees&quot;</span>
            <span class="n">dset</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;long_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;azimuthal bin center&quot;</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">azimuth_bins</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">):</span>
                <span class="n">aedges</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">azimuth_bins</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">acentres</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">azimuth_axis</span>
                <span class="n">awidth</span> <span class="o">=</span> <span class="n">acentres</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">acentres</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">aedges</span> <span class="o">=</span> <span class="p">(</span><span class="n">acentres</span> <span class="o">-</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">awidth</span><span class="p">)</span>
                <span class="n">aedges</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">aedges</span><span class="p">,</span> <span class="n">aedges</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">awidth</span><span class="p">)</span>

            <span class="n">dset2</span> <span class="o">=</span> <span class="n">azint2d</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;azimuthal_axis_edges&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">aedges</span><span class="p">)</span>
            <span class="n">dset2</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;units&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;degrees&quot;</span>
            <span class="n">dset2</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;long_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;azimuthal bin edges&quot;</span>

            <span class="n">azint1dSE</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;data&quot;</span>
            <span class="n">azint2dSE</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;data&quot;</span>
            <span class="n">entry</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;data&quot;</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">write_1d</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Creating just 1D data ...&quot;</span><span class="p">)</span>
            <span class="c1"># ONLY 1D DATA section</span>
            <span class="n">reduction</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="s2">&quot;reduction&quot;</span><span class="p">,</span> <span class="n">track_order</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">reduction</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;NX_class&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;NXprocess&quot;</span>
            <span class="n">prog</span> <span class="o">=</span> <span class="n">reduction</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;program&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s2">&quot;azint-pipeline&quot;</span><span class="p">)</span>
            <span class="n">ver</span> <span class="o">=</span> <span class="n">reduction</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;version&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;azint </span><span class="si">{</span><span class="n">azint</span><span class="o">.</span><span class="n">__version__</span><span class="si">}</span><span class="se">\n</span><span class="s2">azint-writer </span><span class="si">{</span><span class="n">__version__</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">date</span> <span class="o">=</span> <span class="n">reduction</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;date&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%A, %B </span><span class="si">%d</span><span class="s2">, %Y at %I:%M %p&quot;</span><span class="p">))</span>
            <span class="n">ref</span> <span class="o">=</span> <span class="n">reduction</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;reference&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s2">&quot;Jensen, A. B., et al., (2022). J. Synchrotron Rad. 29, 1420-1428.</span><span class="se">\n</span><span class="s2">https://doi.org/10.1107/S1600577522008232,</span><span class="se">\n</span><span class="s2">https://maxiv-science.github.io/azint/&quot;</span><span class="p">)</span>
            <span class="n">note</span> <span class="o">=</span> <span class="n">reduction</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;note&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s2">&quot;Geometry convention:</span><span class="se">\n</span><span class="s2">Azimuthal origin in the horizontal plane to the right of the beam position, i.e., at 3 o’clock,</span><span class="se">\n</span><span class="s2">on the detector face. Positive azimuthal direction: clockwise.&quot;</span><span class="p">)</span>

            <span class="nb">input</span> <span class="o">=</span> <span class="n">reduction</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="s2">&quot;input&quot;</span><span class="p">,</span> <span class="n">track_order</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="nb">input</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;NX_class&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;NXparameters&quot;</span>
            <span class="n">dset</span> <span class="o">=</span> <span class="nb">input</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;poni&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">ponif</span><span class="p">,</span> <span class="n">track_order</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">dset</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;filename&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">poni_file</span>
            <span class="c1"># Add wavelength and energy to mono</span>
            <span class="n">wavelength</span> <span class="o">=</span> <span class="n">mono</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;wavelength&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">wlength</span> <span class="o">*</span> <span class="mf">1e10</span><span class="p">,</span> <span class="n">track_order</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">wavelength</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;units&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;angstrom&quot;</span>
            <span class="n">energy</span> <span class="o">=</span> <span class="n">mono</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;energy&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">(</span><span class="mf">1.2398</span> <span class="o">*</span> <span class="mf">1e-9</span><span class="p">)</span> <span class="o">/</span> <span class="n">wlength</span><span class="p">,</span> <span class="n">track_order</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">energy</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;units&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;keV&quot;</span>

            <span class="c1"># Add other info from poni to input</span>
            <span class="n">wavelength2</span> <span class="o">=</span> <span class="nb">input</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;wavelength&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">wlength</span> <span class="o">*</span> <span class="mf">1e10</span><span class="p">)</span>     
            <span class="n">wavelength2</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;units&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;angstrom&quot;</span>

            <span class="nb">input</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;n_splitting&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">n_splitting</span><span class="p">)</span>
            <span class="nb">input</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;radial_bins&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">radial_bins</span><span class="p">)</span>
            <span class="n">azimuth_bins</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">azimuth_bins</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">azimuth_bins</span> <span class="k">else</span> <span class="mi">1</span>
            <span class="nb">input</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;azimuth_bins&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">azimuth_bins</span><span class="p">)</span>
            <span class="nb">input</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;unit&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">unit</span><span class="p">)</span>
            <span class="nb">input</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;mask&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">mask_path</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">mask_path</span> <span class="k">else</span> <span class="p">(</span><span class="s2">&quot;A numpy array was provided&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">mask</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="s2">&quot;None&quot;</span><span class="p">))</span>

            <span class="nb">input</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;solid_angle&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="kc">True</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">solid_angle</span> <span class="k">else</span> <span class="kc">False</span><span class="p">)</span>

            <span class="n">polarization</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">polarization_factor</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">polarization_factor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="mi">0</span>
            <span class="nb">input</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;polarization_factor&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">polarization</span><span class="p">)</span>
            <span class="n">error_model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">error_model</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">error_model</span> <span class="k">else</span> <span class="s2">&quot;None&quot;</span>
            <span class="nb">input</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;error_model&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">error_model</span><span class="p">)</span>

            <span class="n">azint1d</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="n">track_order</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">azint1d</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;NX_class&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;NXdata&quot;</span>
            <span class="n">azint1d</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;signal&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;I&quot;</span>
            <span class="n">azint1d</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;axes&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="s2">&quot;radial_axis&quot;</span><span class="p">]</span>
            <span class="n">azint1d</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;interpretation&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;spectrum&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write_radial_axis</span><span class="p">(</span><span class="n">azint1d</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">unit</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">radial_axis</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">radial_bins</span><span class="p">)</span>

            <span class="n">entry</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;data&quot;</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">write_2d</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Creating just 2D data ...&quot;</span><span class="p">)</span>
            <span class="c1"># ONLY 2D DATA section</span>
            <span class="n">reduction</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="s2">&quot;reduction&quot;</span><span class="p">,</span> <span class="n">track_order</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">reduction</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;NX_class&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;NXprocess&quot;</span>
            <span class="n">prog</span> <span class="o">=</span> <span class="n">reduction</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;program&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s2">&quot;azint-pipeline&quot;</span><span class="p">)</span>
            <span class="n">ver</span> <span class="o">=</span> <span class="n">reduction</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;version&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;azint </span><span class="si">{</span><span class="n">azint</span><span class="o">.</span><span class="n">__version__</span><span class="si">}</span><span class="se">\n</span><span class="s2">azint-writer </span><span class="si">{</span><span class="n">__version__</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">date</span> <span class="o">=</span> <span class="n">reduction</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;date&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%A, %B </span><span class="si">%d</span><span class="s2">, %Y at %I:%M %p&quot;</span><span class="p">))</span>
            <span class="n">ref</span> <span class="o">=</span> <span class="n">reduction</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;reference&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s2">&quot;Jensen, A. B., et al., (2022). J. Synchrotron Rad. 29, 1420-1428.</span><span class="se">\n</span><span class="s2">https://doi.org/10.1107/S1600577522008232,</span><span class="se">\n</span><span class="s2">https://maxiv-science.github.io/azint/&quot;</span><span class="p">)</span>
            <span class="n">note</span> <span class="o">=</span> <span class="n">reduction</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;note&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s2">&quot;Geometry convention:</span><span class="se">\n</span><span class="s2">Azimuthal origin in the horizontal plane to the right of the beam position, i.e., at 3 o’clock,</span><span class="se">\n</span><span class="s2">on the detector face. Positive azimuthal direction: clockwise.&quot;</span><span class="p">)</span>

            <span class="nb">input</span> <span class="o">=</span> <span class="n">reduction</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="s2">&quot;input&quot;</span><span class="p">,</span> <span class="n">track_order</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="nb">input</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;NX_class&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;NXparameters&quot;</span>
            <span class="n">dset</span> <span class="o">=</span> <span class="nb">input</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;poni&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">ponif</span><span class="p">,</span> <span class="n">track_order</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">dset</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;filename&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">poni_file</span>
            <span class="c1"># Add wavelength and energy to mono</span>
            <span class="n">wavelength</span> <span class="o">=</span> <span class="n">mono</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;wavelength&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">wlength</span> <span class="o">*</span> <span class="mf">1e10</span><span class="p">,</span> <span class="n">track_order</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">wavelength</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;units&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;angstrom&quot;</span>
            <span class="n">energy</span> <span class="o">=</span> <span class="n">mono</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;energy&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">(</span><span class="mf">1.2398</span> <span class="o">*</span> <span class="mf">1e-9</span><span class="p">)</span> <span class="o">/</span> <span class="n">wlength</span><span class="p">,</span> <span class="n">track_order</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">energy</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;units&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;keV&quot;</span>

            <span class="c1"># Add other info from poni to input</span>
            <span class="n">wavelength2</span> <span class="o">=</span> <span class="nb">input</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;wavelength&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">wlength</span> <span class="o">*</span> <span class="mf">1e10</span><span class="p">)</span>     
            <span class="n">wavelength2</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;units&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;angstrom&quot;</span>

            <span class="nb">input</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;n_splitting&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">n_splitting</span><span class="p">)</span>
            <span class="nb">input</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;radial_bins&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">radial_bins</span><span class="p">)</span>
            <span class="n">azimuth_bins</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">azimuth_bins</span>
            <span class="nb">input</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;azimuth_bins&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">azimuth_bins</span><span class="p">)</span>
            <span class="nb">input</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;unit&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">unit</span><span class="p">)</span>
            <span class="nb">input</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;mask&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">mask_path</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">mask_path</span> <span class="k">else</span> <span class="p">(</span><span class="s2">&quot;A numpy array was provided&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">mask</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="s2">&quot;None&quot;</span><span class="p">))</span>

            <span class="nb">input</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;solid_angle&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="kc">True</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">solid_angle</span> <span class="k">else</span> <span class="kc">False</span><span class="p">)</span>

            <span class="n">polarization</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">polarization_factor</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">polarization_factor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="mi">0</span>
            <span class="nb">input</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;polarization_factor&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">polarization</span><span class="p">)</span>
            <span class="n">error_model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">error_model</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">error_model</span> <span class="k">else</span> <span class="s2">&quot;None&quot;</span>
            <span class="nb">input</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;error_model&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">error_model</span><span class="p">)</span>

            <span class="n">azint2d</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="n">track_order</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">azint2d</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;NX_class&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;NXdata&quot;</span>
            <span class="n">azint2d</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;signal&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;I&quot;</span>
            <span class="n">azint2d</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;axes&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="s2">&quot;azimuthal_axis&quot;</span><span class="p">,</span> <span class="s2">&quot;radial_axis&quot;</span><span class="p">]</span>
            <span class="n">azint2d</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;interpretation&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;image&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write_radial_axis</span><span class="p">(</span><span class="n">azint2d</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">unit</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">radial_axis</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">radial_bins</span><span class="p">)</span>
            <span class="n">dset</span> <span class="o">=</span> <span class="n">azint2d</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;azimuthal_axis&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">azimuth_axis</span><span class="p">)</span>
            <span class="n">dset</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;units&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;degrees&quot;</span>
            <span class="n">dset</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;long_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;azimuthal bin center&quot;</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">azimuth_bins</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">):</span>
                <span class="n">aedges</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">azimuth_bins</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">acentres</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">azimuth_axis</span>
                <span class="n">awidth</span> <span class="o">=</span> <span class="n">acentres</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">acentres</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">aedges</span> <span class="o">=</span> <span class="p">(</span><span class="n">acentres</span> <span class="o">-</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">awidth</span><span class="p">)</span>
                <span class="n">aedges</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">aedges</span><span class="p">,</span> <span class="n">aedges</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">awidth</span><span class="p">)</span>

            <span class="n">dset2</span> <span class="o">=</span> <span class="n">azint2d</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;azimuthal_axis_edges&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">aedges</span><span class="p">)</span>
            <span class="n">dset2</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;units&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;degrees&quot;</span>
            <span class="n">dset2</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;long_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;azimuthal bin edges&quot;</span>

            <span class="n">entry</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;data&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">integrated_data</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add azimuthal integration data to the HDF5 file under the proper NXdata group.</span>

<span class="sd">        Parameters:</span>
<span class="sd">        - integrated_data (tuple): Tuple of form (I, errors_1d, cake, errors_2d), where:</span>
<span class="sd">            - I: 1D intensity array</span>
<span class="sd">            - errors_1d: 1D error array</span>
<span class="sd">            - cake: 2D intensity array</span>
<span class="sd">            - errors_2d: 2D error array</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">I</span><span class="p">,</span> <span class="n">errors_1d</span><span class="p">,</span> <span class="n">cake</span><span class="p">,</span> <span class="n">errors_2d</span> <span class="o">=</span> <span class="n">integrated_data</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">write_1d</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">write_2d</span><span class="p">):</span>
        <span class="c1"># if cake is not None: # will have eta bins</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;/entry/azint1d/data/I&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">I</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;/entry/azint2d/data/I&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cake</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">normalized</span><span class="p">:</span>
                <span class="n">data</span><span class="p">[</span><span class="s2">&quot;/entry/azint2d/data/norm&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">norm_2d</span>
                <span class="n">data</span><span class="p">[</span><span class="s2">&quot;/entry/azint1d/data/norm&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">norm_1d</span>
            <span class="k">if</span> <span class="n">errors_2d</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">data</span><span class="p">[</span><span class="s2">&quot;/entry/azint2d/data/I_errors&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">errors_2d</span>
            <span class="k">if</span> <span class="n">errors_1d</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">data</span><span class="p">[</span><span class="s2">&quot;/entry/azint1d/data/I_errors&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">errors_1d</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">write_1d</span><span class="p">:</span>  <span class="c1"># must be radial bins only, no eta, ie 1d.</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;/entry/data/I&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">I</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">normalized</span><span class="p">:</span>
                <span class="n">data</span><span class="p">[</span><span class="s2">&quot;/entry/data/norm&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">norm_1d</span>
            <span class="k">if</span> <span class="n">errors_1d</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">data</span><span class="p">[</span><span class="s2">&quot;/entry/data/I_errors&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">errors_1d</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">write_2d</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;/entry/data/I&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cake</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">normalized</span><span class="p">:</span>
                <span class="n">data</span><span class="p">[</span><span class="s2">&quot;/entry/data/norm&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">norm_2d</span>
            <span class="k">if</span> <span class="n">errors_2d</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">data</span><span class="p">[</span><span class="s2">&quot;/entry/data/I_errors&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">errors_2d</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;At least one of 1D or 2D should be written&quot;</span><span class="p">)</span>

        <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output_file</span><span class="p">,</span> <span class="s2">&quot;r+&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fh_u</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">new_dset</span> <span class="o">=</span> <span class="n">fh_u</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">new_dset</span><span class="p">:</span>
                    <span class="n">new_dset</span> <span class="o">=</span> <span class="n">fh_u</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">value</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span>
                                                   <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">*</span><span class="n">value</span><span class="o">.</span><span class="n">shape</span><span class="p">),</span>
                                                   <span class="n">maxshape</span><span class="o">=</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="n">value</span><span class="o">.</span><span class="n">shape</span><span class="p">),</span>
                                                   <span class="n">chunks</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">*</span><span class="n">value</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
                    <span class="c1"># I and I_error created here</span>
                    <span class="n">new_dset</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;units&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;arbitrary units&quot;</span>
                    <span class="n">new_dset</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;long_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;intensity&quot;</span>
                    <span class="k">if</span> <span class="s2">&quot;I_error&quot;</span> <span class="ow">in</span> <span class="n">key</span><span class="p">:</span>
                        <span class="n">new_dset</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">modify</span><span class="p">(</span><span class="s2">&quot;long_name&quot;</span><span class="p">,</span> <span class="s2">&quot;estimated errors on intensity&quot;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="s2">&quot;norm&quot;</span> <span class="ow">in</span> <span class="n">key</span><span class="p">:</span>
                        <span class="n">new_dset</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">modify</span><span class="p">(</span><span class="s2">&quot;long_name&quot;</span><span class="p">,</span> <span class="s2">&quot;number of pixels contributing to the corresponding bin&quot;</span><span class="p">)</span>

                <span class="n">n</span> <span class="o">=</span> <span class="n">new_dset</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">new_dset</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">new_dset</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">write_radial_axis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">group</span><span class="p">,</span> <span class="n">unit</span><span class="p">,</span> <span class="n">radial_axis</span><span class="p">,</span> <span class="n">radial_bins</span><span class="p">):</span>
        <span class="c1"># real dataset for radial axis is always &quot;radial axis&quot;</span>
        <span class="n">dset</span> <span class="o">=</span> <span class="n">group</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;radial_axis&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">radial_axis</span><span class="p">,</span> <span class="n">track_order</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">dset</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;long_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;q&quot;</span> <span class="k">if</span> <span class="n">unit</span> <span class="o">==</span> <span class="s2">&quot;q&quot;</span> <span class="k">else</span> <span class="s2">&quot;2theta&quot;</span>
        <span class="n">dset</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;units&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;1/angstrom&quot;</span> <span class="k">if</span> <span class="n">unit</span> <span class="o">==</span> <span class="s2">&quot;q&quot;</span> <span class="k">else</span> <span class="s2">&quot;degrees&quot;</span>

        <span class="c1"># Calculate edges</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">radial_bins</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">):</span>
            <span class="n">edges</span> <span class="o">=</span> <span class="n">radial_bins</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">centres</span> <span class="o">=</span> <span class="n">radial_axis</span>
            <span class="n">width</span> <span class="o">=</span> <span class="n">centres</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">centres</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">edges</span> <span class="o">=</span> <span class="p">(</span><span class="n">centres</span><span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="n">width</span><span class="p">)</span>
            <span class="n">edges</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">edges</span><span class="p">,</span><span class="n">edges</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">width</span><span class="p">)</span>

        <span class="n">dsete</span> <span class="o">=</span> <span class="n">group</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;radial_axis_edges&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">edges</span><span class="p">,</span> <span class="n">track_order</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">dsete</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;long_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;q bin edges&quot;</span> <span class="k">if</span> <span class="n">unit</span> <span class="o">==</span> <span class="s2">&quot;q&quot;</span> <span class="k">else</span> <span class="s2">&quot;2theta bin edges&quot;</span>
        <span class="n">dsete</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;units&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;1/angstrom&quot;</span> <span class="k">if</span> <span class="n">unit</span> <span class="o">==</span> <span class="s2">&quot;q&quot;</span> <span class="k">else</span> <span class="s2">&quot;degrees&quot;</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="azint_writer.azint_writer.NXWriter.add_data" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">add_data</span><span class="p">(</span><span class="n">integrated_data</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Add azimuthal integration data to the HDF5 file under the proper NXdata group.</p>
        <ul>
<li>integrated_data (tuple): Tuple of form (I, errors_1d, cake, errors_2d), where:<ul>
<li>I: 1D intensity array</li>
<li>errors_1d: 1D error array</li>
<li>cake: 2D intensity array</li>
<li>errors_2d: 2D error array</li>
</ul>
</li>
</ul>


            <details class="quote">
              <summary>Source code in <code>azint_writer/azint_writer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">add_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">integrated_data</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Add azimuthal integration data to the HDF5 file under the proper NXdata group.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    - integrated_data (tuple): Tuple of form (I, errors_1d, cake, errors_2d), where:</span>
<span class="sd">        - I: 1D intensity array</span>
<span class="sd">        - errors_1d: 1D error array</span>
<span class="sd">        - cake: 2D intensity array</span>
<span class="sd">        - errors_2d: 2D error array</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">I</span><span class="p">,</span> <span class="n">errors_1d</span><span class="p">,</span> <span class="n">cake</span><span class="p">,</span> <span class="n">errors_2d</span> <span class="o">=</span> <span class="n">integrated_data</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">write_1d</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">write_2d</span><span class="p">):</span>
    <span class="c1"># if cake is not None: # will have eta bins</span>
        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;/entry/azint1d/data/I&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">I</span>
        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;/entry/azint2d/data/I&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cake</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">normalized</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;/entry/azint2d/data/norm&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">norm_2d</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;/entry/azint1d/data/norm&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">norm_1d</span>
        <span class="k">if</span> <span class="n">errors_2d</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;/entry/azint2d/data/I_errors&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">errors_2d</span>
        <span class="k">if</span> <span class="n">errors_1d</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;/entry/azint1d/data/I_errors&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">errors_1d</span>
    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">write_1d</span><span class="p">:</span>  <span class="c1"># must be radial bins only, no eta, ie 1d.</span>
        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;/entry/data/I&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">I</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">normalized</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;/entry/data/norm&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">norm_1d</span>
        <span class="k">if</span> <span class="n">errors_1d</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;/entry/data/I_errors&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">errors_1d</span>
    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">write_2d</span><span class="p">:</span>
        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;/entry/data/I&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cake</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">normalized</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;/entry/data/norm&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">norm_2d</span>
        <span class="k">if</span> <span class="n">errors_2d</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;/entry/data/I_errors&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">errors_2d</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;At least one of 1D or 2D should be written&quot;</span><span class="p">)</span>

    <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output_file</span><span class="p">,</span> <span class="s2">&quot;r+&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fh_u</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">new_dset</span> <span class="o">=</span> <span class="n">fh_u</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">new_dset</span><span class="p">:</span>
                <span class="n">new_dset</span> <span class="o">=</span> <span class="n">fh_u</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">value</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span>
                                               <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">*</span><span class="n">value</span><span class="o">.</span><span class="n">shape</span><span class="p">),</span>
                                               <span class="n">maxshape</span><span class="o">=</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="n">value</span><span class="o">.</span><span class="n">shape</span><span class="p">),</span>
                                               <span class="n">chunks</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">*</span><span class="n">value</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
                <span class="c1"># I and I_error created here</span>
                <span class="n">new_dset</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;units&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;arbitrary units&quot;</span>
                <span class="n">new_dset</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;long_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;intensity&quot;</span>
                <span class="k">if</span> <span class="s2">&quot;I_error&quot;</span> <span class="ow">in</span> <span class="n">key</span><span class="p">:</span>
                    <span class="n">new_dset</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">modify</span><span class="p">(</span><span class="s2">&quot;long_name&quot;</span><span class="p">,</span> <span class="s2">&quot;estimated errors on intensity&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="s2">&quot;norm&quot;</span> <span class="ow">in</span> <span class="n">key</span><span class="p">:</span>
                    <span class="n">new_dset</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">modify</span><span class="p">(</span><span class="s2">&quot;long_name&quot;</span><span class="p">,</span> <span class="s2">&quot;number of pixels contributing to the corresponding bin&quot;</span><span class="p">)</span>

            <span class="n">n</span> <span class="o">=</span> <span class="n">new_dset</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">new_dset</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">new_dset</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="azint_writer.azint_writer.NXWriter.write_header" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">write_header</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Creates and writes the NeXus hierarchy for the dataset,
including metadata such as instrument configuration, 
source details, monochromator properties, and integration parameters.</p>
<p>This method will automatically determine what type(s) of data 
(1D/2D) are to be written and populate corresponding subentries.</p>


            <details class="quote">
              <summary>Source code in <code>azint_writer/azint_writer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">write_header</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates and writes the NeXus hierarchy for the dataset,</span>
<span class="sd">    including metadata such as instrument configuration, </span>
<span class="sd">    source details, monochromator properties, and integration parameters.</span>

<span class="sd">    This method will automatically determine what type(s) of data </span>
<span class="sd">    (1D/2D) are to be written and populate corresponding subentries.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;writing header started, azint version is </span><span class="si">{</span><span class="n">azint</span><span class="o">.</span><span class="n">__version__</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">entry</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fh</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="s2">&quot;entry&quot;</span><span class="p">,</span> <span class="n">track_order</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">entry</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;NX_class&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;NXentry&quot;</span>
    <span class="n">entry</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;data&quot;</span> 
    <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;entry is created in the file&quot;</span><span class="p">)</span>


    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">write_1d</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">write_2d</span><span class="p">):</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Creating </span><span class="si">{</span><span class="s1">&#39;NXazint1d&#39;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">write_1d</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;NXazint2d&#39;</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">definition</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;definition&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s1">&#39;NXazint1d&#39;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">write_1d</span> <span class="k">else</span> <span class="s1">&#39;NXazint2d&#39;</span><span class="p">)</span>       

    <span class="n">solid_angle</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;solid_angle_applied&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="kc">True</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">solid_angle</span> <span class="k">else</span> <span class="kc">False</span><span class="p">)</span>

    <span class="n">polarization</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">polarization_factor</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">polarization_factor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="mi">0</span>
    <span class="n">polarization_applied</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;polarization_applied&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="kc">True</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">polarization_factor</span>  <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">False</span><span class="p">)</span>

    <span class="n">normalization</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;normalization_applied&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="kc">True</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">normalized</span> <span class="k">else</span> <span class="kc">False</span><span class="p">)</span>

    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;solid_angle_applied and polarization_applied data sets are created&quot;</span><span class="p">)</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;solid_angle: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">solid_angle</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;polarization_factor: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">polarization_factor</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>


    <span class="c1"># Add instrument</span>
    <span class="n">instrument</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="s2">&quot;instrument&quot;</span><span class="p">,</span> <span class="n">track_order</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">instrument</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;NX_class&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;NXinstrument&quot;</span>
    <span class="n">instrument</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;name&quot;</span> 
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Instrument: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">instrument_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">instrument</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">string_</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">instrument_name</span><span class="p">)</span>

    <span class="c1"># Add monochromator</span>
    <span class="n">mono</span> <span class="o">=</span> <span class="n">instrument</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="s2">&quot;monochromator&quot;</span><span class="p">,</span> <span class="n">track_order</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">mono</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;NX_class&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;NXmonochromator&quot;</span>
    <span class="n">mono</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;energy&quot;</span>  

    <span class="c1"># Add source</span>
    <span class="n">source</span> <span class="o">=</span> <span class="n">instrument</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="s2">&quot;source&quot;</span><span class="p">,</span> <span class="n">track_order</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">source</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;NX_class&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;NXsource&quot;</span>
    <span class="n">source</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;name&quot;</span> 
    <span class="n">source</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">source_name</span>
    <span class="n">source</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">source_type</span>
    <span class="n">source</span><span class="p">[</span><span class="s1">&#39;probe&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">source_type</span>

    <span class="n">poni_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">poni</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">poni</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">poni_file</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">pf</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Reading poni file ...&quot;</span><span class="p">)</span>
                <span class="n">ponif</span> <span class="o">=</span> <span class="n">pf</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
                <span class="n">wavelength_found</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">ponif</span><span class="o">.</span><span class="n">splitlines</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Wavelength:&quot;</span><span class="p">):</span>
                        <span class="n">wlength_str</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">wlength</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">wlength_str</span><span class="p">)</span>
                            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;From poni file: wavelength: </span><span class="si">{</span><span class="n">wlength</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">1e10</span><span class="si">}</span><span class="s2"> Å&quot;</span><span class="p">)</span>
                            <span class="n">wavelength_found</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                            <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error converting wavelength to float: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                            <span class="n">wlength</span> <span class="o">=</span> <span class="kc">None</span>
                        <span class="k">break</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">wavelength_found</span><span class="p">:</span>
                    <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Wavelength not found in poni file.&quot;</span><span class="p">)</span>
                    <span class="n">wlength</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Cannot open poni file: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">poni</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="n">ponif</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">poni</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
        <span class="n">wavelength_found</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">wlength</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">poni</span><span class="p">[</span><span class="s1">&#39;wavelength&#39;</span><span class="p">])</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;From poni file: wavelength: </span><span class="si">{</span><span class="n">wlength</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">1e10</span><span class="si">}</span><span class="s2"> Å&quot;</span><span class="p">)</span>
            <span class="n">wavelength_found</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error converting wavelength to float: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">wlength</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">wavelength_found</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Wavelength not found in poni dict.&quot;</span><span class="p">)</span>
            <span class="n">wlength</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Provided format for poni is wrong.&quot;</span><span class="p">)</span>

    <span class="c1"># Now handle data splitting</span>
    <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">write_1d</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">write_2d</span><span class="p">):</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Creating 1D and 2D data ...&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">azimuth_axis</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;2d data is not available.&quot;</span><span class="p">)</span>
        <span class="c1"># 1D data subentry</span>
        <span class="n">azint1dSE</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="s2">&quot;azint1d&quot;</span><span class="p">,</span> <span class="n">track_order</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">azint1dSE</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;NX_class&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;NXsubentry&quot;</span>

        <span class="n">definition</span> <span class="o">=</span> <span class="n">azint1dSE</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;definition&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s2">&quot;NXazint1d&quot;</span><span class="p">)</span>

        <span class="n">azint1dSE</span><span class="p">[</span><span class="s2">&quot;instrument&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">h5py</span><span class="o">.</span><span class="n">SoftLink</span><span class="p">(</span><span class="s1">&#39;/entry/instrument&#39;</span><span class="p">)</span>

        <span class="n">reduction</span> <span class="o">=</span> <span class="n">azint1dSE</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="s2">&quot;reduction&quot;</span><span class="p">,</span> <span class="n">track_order</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">reduction</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;NX_class&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;NXprocess&quot;</span>
        <span class="n">prog</span> <span class="o">=</span> <span class="n">reduction</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;program&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s2">&quot;azint&quot;</span><span class="p">)</span>
        <span class="n">ver</span> <span class="o">=</span> <span class="n">reduction</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;version&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;azint </span><span class="si">{</span><span class="n">azint</span><span class="o">.</span><span class="n">__version__</span><span class="si">}</span><span class="se">\n</span><span class="s2">azint-writer </span><span class="si">{</span><span class="n">__version__</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">date</span> <span class="o">=</span> <span class="n">reduction</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;date&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%A, %B </span><span class="si">%d</span><span class="s2">, %Y at %I:%M %p&quot;</span><span class="p">))</span>
        <span class="n">ref</span> <span class="o">=</span> <span class="n">reduction</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;reference&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s2">&quot;Jensen, A. B., et al., (2022). J. Synchrotron Rad. 29, 1420-1428.</span><span class="se">\n</span><span class="s2">https://doi.org/10.1107/S1600577522008232,</span><span class="se">\n</span><span class="s2">https://maxiv-science.github.io/azint/&quot;</span><span class="p">)</span>
        <span class="n">note</span> <span class="o">=</span> <span class="n">reduction</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;note&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s2">&quot;Geometry convention:</span><span class="se">\n</span><span class="s2">Azimuthal origin in the horizontal plane to the right of the beam position, i.e., at 3 o’clock,</span><span class="se">\n</span><span class="s2">on the detector face. Positive azimuthal direction: clockwise.&quot;</span><span class="p">)</span>

        <span class="nb">input</span> <span class="o">=</span> <span class="n">reduction</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="s2">&quot;input&quot;</span><span class="p">,</span> <span class="n">track_order</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="nb">input</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;NX_class&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;NXparameters&quot;</span>
        <span class="n">dset</span> <span class="o">=</span> <span class="nb">input</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;poni&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">ponif</span><span class="p">,</span> <span class="n">track_order</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">dset</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;filename&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">poni_file</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">poni</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="s2">&quot;Poni dict.&quot;</span>

        <span class="n">wavelength</span> <span class="o">=</span> <span class="n">mono</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;wavelength&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">wlength</span> <span class="o">*</span> <span class="mf">1e10</span><span class="p">,</span> <span class="n">track_order</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">wavelength</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;units&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;angstrom&quot;</span>
        <span class="n">energy</span> <span class="o">=</span> <span class="n">mono</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;energy&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">(</span><span class="mf">1.2398</span> <span class="o">*</span> <span class="mf">1e-9</span><span class="p">)</span> <span class="o">/</span> <span class="n">wlength</span><span class="p">,</span> <span class="n">track_order</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">energy</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;units&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;keV&quot;</span>

        <span class="n">wavelength2</span> <span class="o">=</span> <span class="nb">input</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;wavelength&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">wlength</span> <span class="o">*</span> <span class="mf">1e10</span><span class="p">)</span>
        <span class="n">wavelength2</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;units&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;angstrom&quot;</span>

        <span class="nb">input</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;n_splitting&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">n_splitting</span><span class="p">)</span>
        <span class="nb">input</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;radial_bins&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">radial_bins</span><span class="p">)</span>
        <span class="nb">input</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;azimuth_bins&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="nb">input</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;unit&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">unit</span><span class="p">)</span>    
        <span class="nb">input</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;mask&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">mask_path</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">mask_path</span> <span class="k">else</span> <span class="p">(</span><span class="s2">&quot;A numpy array was provided&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">mask</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="s2">&quot;None&quot;</span><span class="p">))</span>

        <span class="nb">input</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;solid_angle&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="kc">True</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">solid_angle</span> <span class="k">else</span> <span class="kc">False</span><span class="p">)</span>

        <span class="n">polarization</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">polarization_factor</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">polarization_factor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="mi">0</span>
        <span class="nb">input</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;polarization_factor&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">polarization</span><span class="p">)</span>
        <span class="n">error_model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">error_model</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">error_model</span> <span class="k">else</span> <span class="s2">&quot;None&quot;</span>
        <span class="nb">input</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;error_model&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">error_model</span><span class="p">)</span>


        <span class="n">azint1d</span> <span class="o">=</span> <span class="n">azint1dSE</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">)</span>
        <span class="n">azint1d</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;NX_class&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;NXdata&quot;</span>
        <span class="n">azint1d</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;signal&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;I&quot;</span>
        <span class="n">azint1d</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;axes&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="s2">&quot;radial_axis&quot;</span><span class="p">]</span>
        <span class="n">azint1d</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;interpretation&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;spectrum&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_radial_axis</span><span class="p">(</span><span class="n">azint1d</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">unit</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">radial_axis</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">radial_bins</span><span class="p">)</span>

        <span class="n">azint2dSE</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="s2">&quot;azint2d&quot;</span><span class="p">,</span> <span class="n">track_order</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">azint2dSE</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;NX_class&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;NXsubentry&quot;</span>

        <span class="n">definition</span> <span class="o">=</span> <span class="n">azint2dSE</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;definition&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s2">&quot;NXazint2d&quot;</span><span class="p">)</span>

        <span class="n">azint2dSE</span><span class="p">[</span><span class="s2">&quot;instrument&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">h5py</span><span class="o">.</span><span class="n">SoftLink</span><span class="p">(</span><span class="s1">&#39;/entry/instrument&#39;</span><span class="p">)</span>

        <span class="n">reduction</span> <span class="o">=</span> <span class="n">azint2dSE</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="s2">&quot;reduction&quot;</span><span class="p">,</span> <span class="n">track_order</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">reduction</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;NX_class&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;NXprocess&quot;</span>
        <span class="n">prog</span> <span class="o">=</span> <span class="n">reduction</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;program&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s2">&quot;azint-pipeline&quot;</span><span class="p">)</span>
        <span class="n">ver</span> <span class="o">=</span> <span class="n">reduction</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;version&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;azint </span><span class="si">{</span><span class="n">azint</span><span class="o">.</span><span class="n">__version__</span><span class="si">}</span><span class="se">\n</span><span class="s2">azint-writer </span><span class="si">{</span><span class="n">__version__</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">date</span> <span class="o">=</span> <span class="n">reduction</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;date&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%A, %B </span><span class="si">%d</span><span class="s2">, %Y at %I:%M %p&quot;</span><span class="p">))</span>
        <span class="n">ref</span> <span class="o">=</span> <span class="n">reduction</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;reference&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s2">&quot;Jensen, A. B., et al., (2022). J. Synchrotron Rad. 29, 1420-1428.</span><span class="se">\n</span><span class="s2">https://doi.org/10.1107/S1600577522008232,</span><span class="se">\n</span><span class="s2">https://maxiv-science.github.io/azint/&quot;</span><span class="p">)</span>
        <span class="n">note</span> <span class="o">=</span> <span class="n">reduction</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;note&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s2">&quot;Geometry convention:</span><span class="se">\n</span><span class="s2">Azimuthal origin in the horizontal plane to the right of the beam position, i.e., at 3 o’clock,</span><span class="se">\n</span><span class="s2">on the detector face. Positive azimuthal direction: clockwise.&quot;</span><span class="p">)</span>

        <span class="nb">input</span> <span class="o">=</span> <span class="n">reduction</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="s2">&quot;input&quot;</span><span class="p">,</span> <span class="n">track_order</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="nb">input</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;NX_class&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;NXparameters&quot;</span>

        <span class="n">wavelength2</span> <span class="o">=</span> <span class="nb">input</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;wavelength&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">wlength</span> <span class="o">*</span> <span class="mf">1e10</span><span class="p">)</span>
        <span class="n">wavelength2</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;units&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;angstrom&quot;</span>

        <span class="nb">input</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;n_splitting&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">n_splitting</span><span class="p">)</span>
        <span class="nb">input</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;radial_bins&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">radial_bins</span><span class="p">)</span>
        <span class="nb">input</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;azimuth_bins&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">azimuth_bins</span><span class="p">)</span>
        <span class="nb">input</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;unit&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">unit</span><span class="p">)</span>
        <span class="nb">input</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;mask&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">mask_path</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">mask_path</span> <span class="k">else</span> <span class="p">(</span><span class="s2">&quot;A numpy array was provided&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">mask</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="s2">&quot;None&quot;</span><span class="p">))</span>

        <span class="nb">input</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;solid_angle&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="kc">True</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">solid_angle</span> <span class="k">else</span> <span class="kc">False</span><span class="p">)</span>

        <span class="n">polarization</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">polarization_factor</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">polarization_factor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="mi">0</span>
        <span class="nb">input</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;polarization_factor&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">polarization</span><span class="p">)</span>
        <span class="n">error_model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">error_model</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">error_model</span> <span class="k">else</span> <span class="s2">&quot;None&quot;</span>
        <span class="nb">input</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;error_model&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">error_model</span><span class="p">)</span>

        <span class="n">azint2d</span> <span class="o">=</span> <span class="n">azint2dSE</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">)</span>
        <span class="n">azint2d</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;NX_class&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;NXdata&quot;</span>
        <span class="n">azint2d</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;signal&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;I&quot;</span>
        <span class="n">azint2d</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;axes&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="s2">&quot;azimuthal_axis&quot;</span><span class="p">,</span> <span class="s2">&quot;radial_axis&quot;</span><span class="p">]</span>
        <span class="n">azint2d</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;interpretation&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;image&quot;</span>
        <span class="n">entry</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">h5py</span><span class="o">.</span><span class="n">SoftLink</span><span class="p">(</span><span class="s1">&#39;/entry/azint1d/data&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_radial_axis</span><span class="p">(</span><span class="n">azint2d</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">unit</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">radial_axis</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">radial_bins</span><span class="p">)</span>
        <span class="n">dset</span> <span class="o">=</span> <span class="n">azint2d</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;azimuthal_axis&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">azimuth_axis</span><span class="p">)</span>
        <span class="n">dset</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;units&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;degrees&quot;</span>
        <span class="n">dset</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;long_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;azimuthal bin center&quot;</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">azimuth_bins</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">):</span>
            <span class="n">aedges</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">azimuth_bins</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">acentres</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">azimuth_axis</span>
            <span class="n">awidth</span> <span class="o">=</span> <span class="n">acentres</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">acentres</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">aedges</span> <span class="o">=</span> <span class="p">(</span><span class="n">acentres</span> <span class="o">-</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">awidth</span><span class="p">)</span>
            <span class="n">aedges</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">aedges</span><span class="p">,</span> <span class="n">aedges</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">awidth</span><span class="p">)</span>

        <span class="n">dset2</span> <span class="o">=</span> <span class="n">azint2d</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;azimuthal_axis_edges&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">aedges</span><span class="p">)</span>
        <span class="n">dset2</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;units&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;degrees&quot;</span>
        <span class="n">dset2</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;long_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;azimuthal bin edges&quot;</span>

        <span class="n">azint1dSE</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;data&quot;</span>
        <span class="n">azint2dSE</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;data&quot;</span>
        <span class="n">entry</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;data&quot;</span>

    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">write_1d</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Creating just 1D data ...&quot;</span><span class="p">)</span>
        <span class="c1"># ONLY 1D DATA section</span>
        <span class="n">reduction</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="s2">&quot;reduction&quot;</span><span class="p">,</span> <span class="n">track_order</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">reduction</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;NX_class&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;NXprocess&quot;</span>
        <span class="n">prog</span> <span class="o">=</span> <span class="n">reduction</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;program&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s2">&quot;azint-pipeline&quot;</span><span class="p">)</span>
        <span class="n">ver</span> <span class="o">=</span> <span class="n">reduction</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;version&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;azint </span><span class="si">{</span><span class="n">azint</span><span class="o">.</span><span class="n">__version__</span><span class="si">}</span><span class="se">\n</span><span class="s2">azint-writer </span><span class="si">{</span><span class="n">__version__</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">date</span> <span class="o">=</span> <span class="n">reduction</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;date&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%A, %B </span><span class="si">%d</span><span class="s2">, %Y at %I:%M %p&quot;</span><span class="p">))</span>
        <span class="n">ref</span> <span class="o">=</span> <span class="n">reduction</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;reference&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s2">&quot;Jensen, A. B., et al., (2022). J. Synchrotron Rad. 29, 1420-1428.</span><span class="se">\n</span><span class="s2">https://doi.org/10.1107/S1600577522008232,</span><span class="se">\n</span><span class="s2">https://maxiv-science.github.io/azint/&quot;</span><span class="p">)</span>
        <span class="n">note</span> <span class="o">=</span> <span class="n">reduction</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;note&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s2">&quot;Geometry convention:</span><span class="se">\n</span><span class="s2">Azimuthal origin in the horizontal plane to the right of the beam position, i.e., at 3 o’clock,</span><span class="se">\n</span><span class="s2">on the detector face. Positive azimuthal direction: clockwise.&quot;</span><span class="p">)</span>

        <span class="nb">input</span> <span class="o">=</span> <span class="n">reduction</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="s2">&quot;input&quot;</span><span class="p">,</span> <span class="n">track_order</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="nb">input</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;NX_class&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;NXparameters&quot;</span>
        <span class="n">dset</span> <span class="o">=</span> <span class="nb">input</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;poni&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">ponif</span><span class="p">,</span> <span class="n">track_order</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">dset</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;filename&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">poni_file</span>
        <span class="c1"># Add wavelength and energy to mono</span>
        <span class="n">wavelength</span> <span class="o">=</span> <span class="n">mono</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;wavelength&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">wlength</span> <span class="o">*</span> <span class="mf">1e10</span><span class="p">,</span> <span class="n">track_order</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">wavelength</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;units&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;angstrom&quot;</span>
        <span class="n">energy</span> <span class="o">=</span> <span class="n">mono</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;energy&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">(</span><span class="mf">1.2398</span> <span class="o">*</span> <span class="mf">1e-9</span><span class="p">)</span> <span class="o">/</span> <span class="n">wlength</span><span class="p">,</span> <span class="n">track_order</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">energy</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;units&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;keV&quot;</span>

        <span class="c1"># Add other info from poni to input</span>
        <span class="n">wavelength2</span> <span class="o">=</span> <span class="nb">input</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;wavelength&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">wlength</span> <span class="o">*</span> <span class="mf">1e10</span><span class="p">)</span>     
        <span class="n">wavelength2</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;units&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;angstrom&quot;</span>

        <span class="nb">input</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;n_splitting&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">n_splitting</span><span class="p">)</span>
        <span class="nb">input</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;radial_bins&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">radial_bins</span><span class="p">)</span>
        <span class="n">azimuth_bins</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">azimuth_bins</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">azimuth_bins</span> <span class="k">else</span> <span class="mi">1</span>
        <span class="nb">input</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;azimuth_bins&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">azimuth_bins</span><span class="p">)</span>
        <span class="nb">input</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;unit&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">unit</span><span class="p">)</span>
        <span class="nb">input</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;mask&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">mask_path</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">mask_path</span> <span class="k">else</span> <span class="p">(</span><span class="s2">&quot;A numpy array was provided&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">mask</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="s2">&quot;None&quot;</span><span class="p">))</span>

        <span class="nb">input</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;solid_angle&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="kc">True</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">solid_angle</span> <span class="k">else</span> <span class="kc">False</span><span class="p">)</span>

        <span class="n">polarization</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">polarization_factor</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">polarization_factor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="mi">0</span>
        <span class="nb">input</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;polarization_factor&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">polarization</span><span class="p">)</span>
        <span class="n">error_model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">error_model</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">error_model</span> <span class="k">else</span> <span class="s2">&quot;None&quot;</span>
        <span class="nb">input</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;error_model&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">error_model</span><span class="p">)</span>

        <span class="n">azint1d</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="n">track_order</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">azint1d</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;NX_class&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;NXdata&quot;</span>
        <span class="n">azint1d</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;signal&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;I&quot;</span>
        <span class="n">azint1d</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;axes&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="s2">&quot;radial_axis&quot;</span><span class="p">]</span>
        <span class="n">azint1d</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;interpretation&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;spectrum&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_radial_axis</span><span class="p">(</span><span class="n">azint1d</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">unit</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">radial_axis</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">radial_bins</span><span class="p">)</span>

        <span class="n">entry</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;data&quot;</span>

    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">write_2d</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Creating just 2D data ...&quot;</span><span class="p">)</span>
        <span class="c1"># ONLY 2D DATA section</span>
        <span class="n">reduction</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="s2">&quot;reduction&quot;</span><span class="p">,</span> <span class="n">track_order</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">reduction</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;NX_class&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;NXprocess&quot;</span>
        <span class="n">prog</span> <span class="o">=</span> <span class="n">reduction</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;program&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s2">&quot;azint-pipeline&quot;</span><span class="p">)</span>
        <span class="n">ver</span> <span class="o">=</span> <span class="n">reduction</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;version&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;azint </span><span class="si">{</span><span class="n">azint</span><span class="o">.</span><span class="n">__version__</span><span class="si">}</span><span class="se">\n</span><span class="s2">azint-writer </span><span class="si">{</span><span class="n">__version__</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">date</span> <span class="o">=</span> <span class="n">reduction</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;date&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%A, %B </span><span class="si">%d</span><span class="s2">, %Y at %I:%M %p&quot;</span><span class="p">))</span>
        <span class="n">ref</span> <span class="o">=</span> <span class="n">reduction</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;reference&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s2">&quot;Jensen, A. B., et al., (2022). J. Synchrotron Rad. 29, 1420-1428.</span><span class="se">\n</span><span class="s2">https://doi.org/10.1107/S1600577522008232,</span><span class="se">\n</span><span class="s2">https://maxiv-science.github.io/azint/&quot;</span><span class="p">)</span>
        <span class="n">note</span> <span class="o">=</span> <span class="n">reduction</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;note&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s2">&quot;Geometry convention:</span><span class="se">\n</span><span class="s2">Azimuthal origin in the horizontal plane to the right of the beam position, i.e., at 3 o’clock,</span><span class="se">\n</span><span class="s2">on the detector face. Positive azimuthal direction: clockwise.&quot;</span><span class="p">)</span>

        <span class="nb">input</span> <span class="o">=</span> <span class="n">reduction</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="s2">&quot;input&quot;</span><span class="p">,</span> <span class="n">track_order</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="nb">input</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;NX_class&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;NXparameters&quot;</span>
        <span class="n">dset</span> <span class="o">=</span> <span class="nb">input</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;poni&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">ponif</span><span class="p">,</span> <span class="n">track_order</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">dset</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;filename&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">poni_file</span>
        <span class="c1"># Add wavelength and energy to mono</span>
        <span class="n">wavelength</span> <span class="o">=</span> <span class="n">mono</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;wavelength&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">wlength</span> <span class="o">*</span> <span class="mf">1e10</span><span class="p">,</span> <span class="n">track_order</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">wavelength</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;units&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;angstrom&quot;</span>
        <span class="n">energy</span> <span class="o">=</span> <span class="n">mono</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;energy&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">(</span><span class="mf">1.2398</span> <span class="o">*</span> <span class="mf">1e-9</span><span class="p">)</span> <span class="o">/</span> <span class="n">wlength</span><span class="p">,</span> <span class="n">track_order</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">energy</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;units&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;keV&quot;</span>

        <span class="c1"># Add other info from poni to input</span>
        <span class="n">wavelength2</span> <span class="o">=</span> <span class="nb">input</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;wavelength&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">wlength</span> <span class="o">*</span> <span class="mf">1e10</span><span class="p">)</span>     
        <span class="n">wavelength2</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;units&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;angstrom&quot;</span>

        <span class="nb">input</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;n_splitting&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">n_splitting</span><span class="p">)</span>
        <span class="nb">input</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;radial_bins&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">radial_bins</span><span class="p">)</span>
        <span class="n">azimuth_bins</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">azimuth_bins</span>
        <span class="nb">input</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;azimuth_bins&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">azimuth_bins</span><span class="p">)</span>
        <span class="nb">input</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;unit&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">unit</span><span class="p">)</span>
        <span class="nb">input</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;mask&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">mask_path</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">mask_path</span> <span class="k">else</span> <span class="p">(</span><span class="s2">&quot;A numpy array was provided&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">mask</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="s2">&quot;None&quot;</span><span class="p">))</span>

        <span class="nb">input</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;solid_angle&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="kc">True</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">solid_angle</span> <span class="k">else</span> <span class="kc">False</span><span class="p">)</span>

        <span class="n">polarization</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">polarization_factor</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">polarization_factor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="mi">0</span>
        <span class="nb">input</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;polarization_factor&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">polarization</span><span class="p">)</span>
        <span class="n">error_model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">error_model</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">error_model</span> <span class="k">else</span> <span class="s2">&quot;None&quot;</span>
        <span class="nb">input</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;error_model&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">error_model</span><span class="p">)</span>

        <span class="n">azint2d</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="n">track_order</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">azint2d</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;NX_class&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;NXdata&quot;</span>
        <span class="n">azint2d</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;signal&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;I&quot;</span>
        <span class="n">azint2d</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;axes&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="s2">&quot;azimuthal_axis&quot;</span><span class="p">,</span> <span class="s2">&quot;radial_axis&quot;</span><span class="p">]</span>
        <span class="n">azint2d</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;interpretation&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;image&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_radial_axis</span><span class="p">(</span><span class="n">azint2d</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">unit</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">radial_axis</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">radial_bins</span><span class="p">)</span>
        <span class="n">dset</span> <span class="o">=</span> <span class="n">azint2d</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;azimuthal_axis&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">azimuth_axis</span><span class="p">)</span>
        <span class="n">dset</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;units&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;degrees&quot;</span>
        <span class="n">dset</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;long_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;azimuthal bin center&quot;</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">azimuth_bins</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">):</span>
            <span class="n">aedges</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">azimuth_bins</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">acentres</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">azimuth_axis</span>
            <span class="n">awidth</span> <span class="o">=</span> <span class="n">acentres</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">acentres</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">aedges</span> <span class="o">=</span> <span class="p">(</span><span class="n">acentres</span> <span class="o">-</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">awidth</span><span class="p">)</span>
            <span class="n">aedges</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">aedges</span><span class="p">,</span> <span class="n">aedges</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">awidth</span><span class="p">)</span>

        <span class="n">dset2</span> <span class="o">=</span> <span class="n">azint2d</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;azimuthal_axis_edges&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">aedges</span><span class="p">)</span>
        <span class="n">dset2</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;units&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;degrees&quot;</span>
        <span class="n">dset2</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;long_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;azimuthal bin edges&quot;</span>

        <span class="n">entry</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;data&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.13a4f30d.min.js"></script>
      
        <script src="../javascripts/mathjax.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>